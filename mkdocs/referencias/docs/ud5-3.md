# **UT5.3: Transformaci√≥n de documentos con JavaScript**

## 5.3.1 Objetivos

- Comprender la estructura y sintaxis de los principales formatos de intercambio de datos: JSON, XML y CSV.
- Identificar herramientas y tecnolog√≠as actuales utilizadas en la conversi√≥n de documentos.
- Utilizar JavaScript para transformar datos entre distintos formatos, tanto en el cliente como en el servidor.
- Aplicar estos conocimientos en una actividad pr√°ctica guiada.

---

## 5.3.2 Introducci√≥n y contextualizaci√≥n

En el desarrollo de aplicaciones web y servicios digitales, el **intercambio de informaci√≥n entre sistemas heterog√©neos** es una necesidad constante. No siempre todos los sistemas usan el mismo formato de datos, por lo que es imprescindible **transformar documentos** de un formato a otro de forma precisa y automatizada.

Los formatos de datos m√°s utilizados en la actualidad para el intercambio son:

- **JSON** (JavaScript Object Notation): ligero, f√°cil de leer y escribir, y muy usado en APIs web.
- **XML** (eXtensible Markup Language): m√°s formal y estructurado, todav√≠a presente en entornos empresariales.
- **CSV** (Comma-Separated Values): muy simple, pero √∫til para intercambiar datos tabulares.

En esta unidad aprender√°s a:

- Comprender la **estructura y sintaxis** de los principales formatos de intercambio.
- Identificar herramientas y tecnolog√≠as que permiten la **conversi√≥n entre documentos**.
- Utilizar **JavaScript** para transformar datos en distintos formatos, tanto en cliente como en servidor.
- Aplicar estos conocimientos en una **actividad pr√°ctica guiada**.

üí° El objetivo principal ser√° priorizar el uso de JSON como formato est√°ndar actual, sin dejar de entender c√≥mo trabajar con XML y CSV en casos donde sea necesario.

### Aplicaciones reales

Algunos casos comunes donde es necesario transformar documentos con JavaScript:

- **Integraci√≥n de APIs antiguas:** muchas APIs todav√≠a devuelven datos en XML. Para trabajar con ellos en aplicaciones modernas, es necesario transformarlos a JSON.
- **Migraci√≥n de sistemas:** transformar XML en JSON permite modernizar la gesti√≥n de datos en nuevas arquitecturas.
- **Visualizaci√≥n de datos:** muchas bibliotecas modernas como D3.js o React trabajan solo con JSON.
- **Carga din√°mica en frontend:** transformar archivos XML a JSON permite cargar configuraciones o datos sin backend.
- **Interacci√≥n con hojas de c√°lculo:** para importar o exportar datos en Excel, es habitual convertir entre JSON y CSV.

---

## 5.3.3 Tecnolog√≠as de transformaci√≥n de documentos. Est√°ndares y √°mbitos de aplicaci√≥n

La transformaci√≥n de documentos es una tarea habitual en el desarrollo web. Por ejemplo, una p√°gina puede necesitar mostrar datos que vienen en formato XML, pero su c√≥digo JavaScript trabaja internamente con JSON. En estos casos, necesitamos herramientas que nos permitan **convertir datos de un formato a otro** de forma autom√°tica y fiable.

### Lenguajes y entornos actuales

#### JavaScript

- Es el lenguaje m√°s utilizado para realizar transformaciones de datos en aplicaciones web.
- Funciona tanto en el **navegador** (frontend) como en **Node.js** (backend).
- Incluye funciones nativas como `JSON.parse()`, `JSON.stringify()` y objetos como `DOMParser` para manipular XML.

#### Herramientas modernas

- **Visual Studio Code**: editor gratuito y muy popular. Dispone de extensiones para trabajar con JSON, XML y CSV, adem√°s de soporte para JavaScript y Node.js.
- **WebStorm**: entorno profesional con funcionalidades avanzadas para desarrollo web y depuraci√≥n.
- **Playgrounds online** como JSFiddle, CodePen o RunKit: permiten probar fragmentos de c√≥digo JavaScript r√°pidamente sin necesidad de entorno local.

#### Bibliotecas y m√≥dulos √∫tiles

- `xml2js` (Node.js): convierte f√°cilmente XML en JSON y viceversa.
- `PapaParse`: librer√≠a muy completa para importar/exportar CSV en el navegador o en Node.js.
- `fast-xml-parser`: alternativa eficiente a `xml2js`, m√°s r√°pida y ligera.

### √Åmbitos de aplicaci√≥n

| √Åmbito                          | Descripci√≥n                                                                 |
|---------------------------------|-----------------------------------------------------------------------------|
| Aplicaciones web modernas       | Transforman datos JSON en tiempo real para representar interfaces din√°micas. |
| Consumo de APIs                 | APIs antiguas pueden devolver XML. Es necesario convertir a JSON para unificar el procesamiento. |
| Automatizaci√≥n y scripting      | Node.js permite convertir documentos en procesos automatizados (por ejemplo, CSV a JSON y luego guardado en base de datos). |
| Interoperabilidad entre sistemas| Cuando una app antigua exporta XML, es necesario convertirlo a JSON para integrarlo con apps modernas. |
| Exportaci√≥n e importaci√≥n de datos | CSV sigue siendo un formato clave para informes, hojas de c√°lculo o intercambios simples. |

---

## 5.3.4 Estructura y sintaxis de los formatos de intercambio

### JSON (formato principal)

```json
{
  "nombre": "Luc√≠a",
  "edad": 19,
  "asignaturas": ["LMSGI", "Programaci√≥n"]
}
```

- Basado en pares clave-valor.
- Soporta estructuras anidadas (listas, objetos).
- Nativo en JavaScript.

### XML (formato heredado)

```xml
<alumno>
  <nombre>Luc√≠a</nombre>
  <edad>19</edad>
</alumno>
```

- Basado en etiquetas.
- Permite estructuras jer√°rquicas complejas.
- M√°s verboso que JSON.

### CSV (formato tabular)

```csv
nombre,edad
Luc√≠a,19
Pedro,20
```

- Formato plano, orientado a filas y columnas.
- No permite estructuras anidadas.

### Resumen comparativo

| Formato | Estructura   | Ventajas principales               | Limitaciones                          |
|---------|--------------|------------------------------------|----------------------------------------|
| JSON    | Jer√°rquica   | Ligero, nativo en JavaScript       | No compatible con hojas de c√°lculo     |
| XML     | Jer√°rquica   | Flexible, v√°lido en sistemas antiguos| Verboso, m√°s dif√≠cil de manipular     |
| CSV     | Tabular      | Simple, compatible con Excel       | No soporta jerarqu√≠as ni listas        |

---

## 5.3.5 Creaci√≥n y uso de transformaciones

### Conversi√≥n con JavaScript

#### Ejemplo: conversi√≥n de XML a JSON en el navegador

Este ejemplo usa `DOMParser` para analizar texto XML y lo transforma en un objeto JSON recorriendo sus nodos hijos.

```js
// XML de ejemplo como cadena de texto
const xmlTexto = `
<persona>
  <nombre>Luc√≠a</nombre>
  <edad>22</edad>
</persona>
`;

// Creamos un parser que interpreta el texto como XML
const parser = new DOMParser();

// Convertimos el texto XML en un documento DOM manipulable
const xmlDoc = parser.parseFromString(xmlTexto, "application/xml");

// Funci√≥n para convertir los nodos del XML en un objeto JSON
function xmlToJson(xml) {
  const obj = {};
  for (let node of xml.children) {
    // Guardamos el nombre del nodo como clave y su contenido como valor
    obj[node.nodeName] = node.textContent;
  }
  return obj;
}

// Ejecutamos la conversi√≥n
const resultado = xmlToJson(xmlDoc.documentElement);

// Mostramos el resultado
console.log(resultado);
```

---

#### Ejemplo: conversi√≥n de CSV a JSON 

Esta funci√≥n analiza un texto CSV con cabecera y lo convierte en una lista de objetos, donde cada fila representa un registro.

```js
// CSV de ejemplo como texto plano
const csv = `nombre,edad
Luc√≠a,22
Pedro,21`;

// Funci√≥n que convierte el CSV a una lista de objetos JSON
function csvToJson(csv) {
  // Separamos el texto en l√≠neas
  const [cabecera, ...filas] = csv.trim().split("\n");

  // Obtenemos las claves a partir de la cabecera
  const campos = cabecera.split(",");

  // Transformamos cada l√≠nea en un objeto
  return filas.map(fila => {
    const valores = fila.split(",");
    const obj = {};
    campos.forEach((campo, i) => obj[campo] = valores[i]);
    return obj;
  });
}

// Resultado de la transformaci√≥n
console.log(csvToJson(csv));
```

---

### Ejemplo: conversi√≥n de JSON a CSV

Esta funci√≥n toma un array de objetos y genera un texto CSV con cabecera y filas separadas por comas.

```js
// Array de objetos que queremos convertir
const datos = [
  { nombre: "Luc√≠a", edad: 22 },
  { nombre: "Pedro", edad: 21 }
];

// Funci√≥n que convierte JSON a texto CSV
function jsonToCsv(datos) {
  // Extraemos las claves del primer objeto (cabecera)
  const cabecera = Object.keys(datos[0]).join(",");

  // Para cada objeto, sacamos sus valores y los unimos por comas
  const filas = datos.map(obj => Object.values(obj).join(","));

  // Juntamos la cabecera y las filas en una cadena CSV
  return [cabecera, ...filas].join("\n");
}

// Mostramos el resultado
console.log(jsonToCsv(datos));
```

---

###  Librer√≠as √∫tiles para transformar documentos

Adem√°s de usar JavaScript puro, en proyectos reales es habitual usar **librer√≠as** que nos ahorran tiempo y c√≥digo. A continuaci√≥n, explicamos dos muy utilizadas: **`xml2js`** para XML y **`PapaParse`** para CSV.

---

#### `xml2js` ‚Äì Conversi√≥n de XML a JSON en Node.js

`xml2js` es una librer√≠a para Node.js que convierte autom√°ticamente XML en objetos JSON. Es muy √∫til cuando trabajamos con archivos XML en el backend o en scripts.

##### Instalaci√≥n

Desde consola, escribe:

```bash
npm install xml2js
```

##### C√≥digo de ejemplo comentado

```js
// Cargamos los m√≥dulos necesarios
const fs = require('fs');
const xml2js = require('xml2js');

// Leemos un archivo XML como texto
const xml = fs.readFileSync('archivo.xml', 'utf8');

// Usamos xml2js para convertirlo a JSON
xml2js.parseString(xml, (err, result) => {
  if (err) {
    console.error("Error al analizar el XML:", err);
    return;
  }
  
  // Mostramos el objeto resultante
  console.log(result);
});
```

##### ¬øQu√© hace este c√≥digo?

- `fs.readFileSync()` carga el contenido del archivo.
- `parseString()` analiza el XML y lo convierte autom√°ticamente en JSON.
- `result` es un objeto que puedes usar en tu aplicaci√≥n, guardarlo, o mostrarlo.

>  **Ventaja**: `xml2js` maneja estructuras complejas, atributos y listas sin necesidad de escribir funciones personalizadas.

---

#### `PapaParse` ‚Äì Lectura y escritura de CSV

`PapaParse` es una de las librer√≠as m√°s completas para trabajar con CSV. Puede usarse tanto en el navegador como en Node.js.

##### Incluir en el navegador

Puedes enlazarla directamente desde un CDN (no necesitas instalar nada):

```html
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
```

##### C√≥digo de ejemplo

```js
// CSV como texto plano
const csvData = `nombre,edad\nLuc√≠a,22\nPedro,21`;

// Usamos PapaParse para convertirlo a JSON
Papa.parse(csvData, {
  header: true, // Indica que la primera fila contiene los nombres de las columnas
  complete: function(results) {
    // El array de objetos JSON est√° en results.data
    console.log(results.data);
  }
});
```

##### ¬øQu√© hace este c√≥digo?

- Analiza autom√°ticamente el CSV.
- Crea un array de objetos con claves y valores.
- Detecta y convierte tipos de datos (n√∫meros, booleanos, etc.) si es necesario.

##### Tambi√©n puedes generar CSV desde JSON:

```js
const datos = [
  { nombre: "Luc√≠a", edad: 22 },
  { nombre: "Pedro", edad: 21 }
];

// Convertimos JSON a CSV
const csv = Papa.unparse(datos);
console.log(csv);
```

##### ¬øPor qu√© usar PapaParse?

- Evita errores al dividir texto manualmente.
- Funciona con archivos reales (puede leer un archivo `.csv` arrastrado o subido).
- Compatible con navegadores y Node.js.

---

## 5.3.6 Actividad guiada: Transformaci√≥n y visualizaci√≥n de datos

### Enunciado

Est√°s desarrollando una p√°gina web para una tienda online. El sistema de inventario es antiguo y exporta los datos en formato **XML**. Tu objetivo es:

- Transformar los datos XML a **JSON** usando **JavaScript**.
- Mostrar los productos en una **tabla HTML**.
- Resaltar en rojo aquellos productos que tengan **poco stock**.

### üìÑ Datos de partida (XML)

```xml
<productos>
  <producto>
    <nombre>Monitor 24"</nombre>
    <precio>149.99</precio>
    <stock>15</stock>
  </producto>
  <producto>
    <nombre>Teclado mec√°nico</nombre>
    <precio>89.50</precio>
    <stock>30</stock>
  </producto>
  <producto>
    <nombre>Rat√≥n inal√°mbrico</nombre>
    <precio>39.99</precio>
    <stock>10</stock>
  </producto>
</productos>
```

### üíª Tareas

1. Introduce el XML como texto en tu archivo HTML.
2. Usa `DOMParser` para convertirlo en un documento DOM.
3. Implementa una funci√≥n `xmlToJson()` para transformar el XML a JSON.
4. Recorre el JSON y genera una tabla HTML con los productos.
5. Resalta en rojo los productos con `stock < 20`.

### üìÅ Archivo HTML con soluci√≥n orientativa

```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario de productos</title>
  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    .bajo-stock { background-color: #fdd; }
  </style>
</head>
<body>
  <h1>Inventario de productos</h1>
  <div id="tabla-contenedor"></div>

  <script>
    const xmlTexto = `
    <productos>
      <producto>
        <nombre>Monitor 24"</nombre>
        <precio>149.99</precio>
        <stock>15</stock>
      </producto>
      <producto>
        <nombre>Teclado mec√°nico</nombre>
        <precio>89.50</precio>
        <stock>30</stock>
      </producto>
      <producto>
        <nombre>Rat√≥n inal√°mbrico</nombre>
        <precio>39.99</precio>
        <stock>10</stock>
      </producto>
    </productos>
    `;

    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xmlTexto, "application/xml");

    function xmlToJson(xml) {
      const productos = [];
      const nodos = xml.getElementsByTagName("producto");

      for (let producto of nodos) {
        const nombre = producto.querySelector("nombre").textContent;
        const precio = parseFloat(producto.querySelector("precio").textContent);
        const stock = parseInt(producto.querySelector("stock").textContent);
        productos.push({ nombre, precio, stock });
      }

      return productos;
    }

    const inventario = xmlToJson(xmlDoc);

    function mostrarTabla(datos) {
      let html = `
        <table>
          <thead>
            <tr><th>Nombre</th><th>Precio</th><th>Stock</th></tr>
          </thead>
          <tbody>
      `;

      datos.forEach(producto => {
        const clase = producto.stock < 20 ? "bajo-stock" : "";
        html += `
          <tr class="${clase}">
            <td>${producto.nombre}</td>
            <td>${producto.precio.toFixed(2)} ‚Ç¨</td>
            <td>${producto.stock}</td>
          </tr>
        `;
      });

      html += "</tbody></table>";
      document.getElementById("tabla-contenedor").innerHTML = html;
    }

    mostrarTabla(inventario);
  </script>
</body>
</html>
```

### Relaci√≥n con el resultado de aprendizaje 5

| Criterio de evaluaci√≥n | C√≥mo se evidencia en la actividad |
|------------------------|----------------------------------|
| **a)** Se ha identificado la necesidad de la conversi√≥n de documentos para el intercambio de la informaci√≥n. | Se parte de una situaci√≥n realista (sistema antiguo XML, web moderna que necesita JSON). |
| **b)** Se han establecido √°mbitos de aplicaci√≥n. | Contexto: tienda online que necesita adaptar su inventario para mostrarlo din√°micamente. |
| **c)** Se han analizado las tecnolog√≠as implicadas y su modo de funcionamiento. | Uso de DOMParser, manipulaci√≥n DOM, conversi√≥n a JSON y renderizado con JS. |
| **d)** Se ha descrito la sintaxis espec√≠fica utilizada en la conversi√≥n. | La actividad est√° basada en XML estructurado y su conversi√≥n a objetos JSON. |
| **e)** Se han creado especificaciones de conversi√≥n. | La funci√≥n `xmlToJson()` convierte productos del DOM XML a objetos manipulables. |
| **f)** Se han identificado y caracterizado herramientas espec√≠ficas. | Se emplea JavaScript puro, DOMParser, plantillas HTML y manipulaci√≥n del DOM. |
| **g)** Se han realizado conversiones sobre documentos para el intercambio de informaci√≥n. | Se ejecuta la transformaci√≥n completa XML ‚Üí JSON ‚Üí visualizaci√≥n HTML. |
