# **UT5.2: Trabajo con APIs**

## Objetivos
‚Ä¢	Comprender qu√© es la asincron√≠a y por qu√© es esencial en el desarrollo web moderno.
‚Ä¢	Aprender a utilizar Promises para gestionar operaciones que no son instant√°neas.
‚Ä¢	Usar Fetch API para conectar nuestra aplicaci√≥n web con APIs p√∫blicas y trabajar con datos externos.
‚Ä¢	Conocer herramientas que ayudan a validar, probar y depurar datos JSON y solicitudes HTTP.
 
## Introducci√≥n

Hoy en d√≠a, muchas aplicaciones web necesitan obtener datos de otros servidores o enviar informaci√≥n sin que la p√°gina se quede bloqueada esperando.
Esto es posible gracias a la asincron√≠a en JavaScript, que permite realizar operaciones ‚Äúen segundo plano‚Äù mientras el programa sigue ejecut√°ndose.

Las principales herramientas que nos ofrece JavaScript para trabajar de forma as√≠ncrona son:
‚Ä¢	Promises: para manejar el resultado de operaciones que tardan un tiempo.
‚Ä¢	Fetch API: para hacer solicitudes HTTP de forma moderna y sencilla.

Adem√°s, para trabajar correctamente con datos JSON (el formato m√°s usado en las APIs), es muy √∫til validar su estructura usando editores inteligentes (WebStorm), herramientas de prueba (Postman) o validadores en l√≠nea.

___

## 5.2.1 Trabajo con APIs

### Asincron√≠a en JavaScript

La asincron√≠a permite que, mientras el navegador espera una respuesta del servidor, otras partes del programa sigan funcionando.
Esto mejora la experiencia de usuario y la eficiencia de las aplicaciones.

Ejemplo:
Mientras esperamos los datos del tiempo de una API, podemos seguir mostrando una animaci√≥n de carga.

### Promises en JavaScript

Una Promise es como una ‚Äúpromesa‚Äù de que una operaci√≥n terminar√° m√°s tarde, con √©xito o con error.

Estados de una Promise:
‚Ä¢	Pending (‚Äúpendiente‚Äù): la operaci√≥n a√∫n no ha terminado.
‚Ä¢	Fulfilled (‚Äúcumplida‚Äù): la operaci√≥n ha terminado con √©xito.
‚Ä¢	Rejected (‚Äúrechazada‚Äù): ha ocurrido un error.

````Javascript
let promesa = new Promise((resolve, reject) => {
    let exito = true;
  
    if (exito) {
        resolve('Operaci√≥n exitosa');
    } else {
        reject('Ocurri√≥ un error');
    }
});

// promesa
.then(mensaje => console.log(mensaje))  // Si todo va bien, muestra el mensaje de √©xito
.catch(error => console.error(error));  // Si hay error, muestra el mensaje de error

Explicaci√≥n paso a paso:
‚Ä¢	Creamos una nueva Promise con dos funciones internas: resolve (√©xito) y reject (error).
‚Ä¢	Simulamos un caso de √©xito con let exito = true.
‚Ä¢	Si exito es true, se ejecuta resolve('Operaci√≥n exitosa').
‚Ä¢	Si fuera false, se ejecutar√≠a reject('Ocurri√≥ un error').
‚Ä¢	Luego, usamos .then() para gestionar el √©xito y .catch() para gestionar el error.

````

### Fetch API en JavaScript

Fetch API es una funci√≥n moderna para hacer peticiones HTTP (por ejemplo, pedir datos a un servidor).

C√≥digo b√°sico:

fetch('URL')
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));

Explicaci√≥n:
1.	fetch('URL') hace la solicitud a la URL indicada.
2.	.then(response => response.json()) transforma la respuesta a formato JSON.
3.	.then(data => console.log(data)) trabaja con los datos recibidos.
4.	.catch(error => console.error('Error:', error)) captura cualquier error.

‚∏ª

### Ejemplo: Consultar Pok√©mon con Fetch API

````Javascript
fetch('https://pokeapi.co/api/v2/pokemon/ditto')
    .then(response => response.json())
    .then(data => {
        console.log('Datos de Ditto:', data);
        console.log('Nombre:', data.name);
        console.log('Altura:', data.height);
        console.log('Peso:', data.weight);
    })
    .catch(error => {
        console.error('Error al obtener el Pok√©mon:', error);
    });

/* Explicaci√≥n del ejemplo:
    ‚Ä¢	Se hace una petici√≥n a la API de Pok√©mon para consultar a Ditto.
    ‚Ä¢	Se transforma la respuesta a JSON.
    ‚Ä¢	Se muestran datos espec√≠ficos: nombre, altura y peso.
    ‚Ä¢	Si ocurre un error (por ejemplo, problema de red), se captura en .catch().
*/
````




Herramientas Recomendadas
- WebStorm:
  - Editor que detecta errores de sintaxis en JSON y JavaScript.
  - Valida autom√°ticamente esquemas JSON.

- Postman:
  - Herramienta para hacer peticiones HTTP f√°cilmente. 
  - Ideal para probar APIs antes de programar la conexi√≥n en JavaScript. 

- JSON Schema Lint:
  - Web para validar la estructura de archivos JSON: https://jsonschemalint.com/

‚∏ª

### Ejercicio Guiado: Consultar Pok√©mon con Fetch API

#### Objetivos del ejercicio
‚Ä¢	Aplicar fetch y Promises para trabajar con APIs p√∫blicas.
‚Ä¢	Extraer informaci√≥n espec√≠fica de la respuesta JSON.
‚Ä¢	Gestionar errores correctamente.



#### Enunciado
Crea un peque√±o programa en JavaScript que:

1.	Solicite los datos de un Pok√©mon concreto usando la Pok√©API:
üìç URL: https://pokeapi.co/api/v2/pokemon/{nombre}
(Sustituye {nombre} por el Pok√©mon que quieras consultar).
2.	Muestre en consola:
   - Nombre del Pok√©mon.
   - Altura (en dec√≠metros).
   - Peso (en hectogramos).
   - Tipos que tiene (por ejemplo, ‚Äúel√©ctrico‚Äù, ‚Äúfuego‚Äù, etc.).
3.	Gestione posibles errores, como que no se encuentre el Pok√©mon.

---

```Javascript
// C√≥digo base recomendado

// 1. Definimos el nombre del Pok√©mon que queremos consultar

const nombrePokemon = 'pikachu'; // Cambia este valor para probar otros Pok√©mon

// 2. Hacemos la solicitud usando Fetch API
fetch(`https://pokeapi.co/api/v2/pokemon/${nombrePokemon}`)
.then(response => {
if (!response.ok) {
throw new Error('Pok√©mon no encontrado');
}
return response.json();
})
.then(data => {
// 3. Mostramos datos relevantes
console.log('Nombre:', data.name);
console.log('Altura:', data.height);
console.log('Peso:', data.weight);

    // 4. Extraemos y mostramos los tipos
    const tipos = data.types.map(tipoInfo => tipoInfo.type.name);
    console.log('Tipos:', tipos.join(', '));
})
.catch(error => {
console.error('Error al obtener el Pok√©mon:', error.message);
});


/* Explicaci√≥n paso a paso
1.Definimos una variable nombrePokemon con el nombre del Pok√©mon a buscar.
2.Realizamos la solicitud fetch() a la API.
3.Comprobamos que response.ok sea true (si no, lanzamos un error).
4.Convertimos la respuesta a JSON.
5.Mostramos en consola:
    ‚Ä¢	El nombre (data.name).
    ‚Ä¢	La altura (data.height).
    ‚Ä¢	El peso (data.weight).
    ‚Ä¢	Los tipos (data.types) mapeados a un array de nombres.
6.Capturamos cualquier error en .catch() y mostramos un mensaje adecuado.

*/

````

### Resultado esperado en consola

Buscando pikachu, deber√≠as ver algo como:

````JSON
Nombre: pikachu
Altura: 4
Peso: 60
Tipos: electric
````

üõ†Ô∏è Tareas Extra (Opcionales)
‚Ä¢	üí° Pedir el nombre del Pok√©mon al usuario usando prompt().
‚Ä¢	üí° Mostrar tambi√©n la imagen del Pok√©mon (data.sprites.front_default) en la p√°gina.
‚Ä¢	üí° Normalizar el nombre (convertirlo a min√∫sculas usando toLowerCase()).

